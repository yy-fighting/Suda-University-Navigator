# 🌐 微信小程序开发任务文档

## 🧭 项目名称：智能景区导览小程序


## 📄 页面结构与跳转逻辑

1. **首页（地图页面）**
2. **路线推荐页面**
3. **路线详情页面**
4. **步行导航页面**
5. **景点讲解页面**

---

## 📍 页面 1：**首页（地图 + 搜索 + 按钮）**

### 🔧 功能列表
- 地图展示（腾讯地图 `<map>` 组件）
- 地理定位（当前位置）
- 搜索框 + 自动联想（模糊搜索）  
  - 使用腾讯地图 `suggestion` API
- 搜索结果列表选择跳转（点击后跳转至**页面5**）
- 下方按钮：
  - [景点讲解]：跳转至页面5，传入当前位置
  - [路线规划]：跳转至页面2

### 📦 数据结构
```js
{
  currentLocation: { lat: Number, lng: Number },
  searchResults: [ { name, address, location: {lat, lng} } ],
  selectedPlace: { name, location }
}
```

---

## 📍 页面 2：**路线推荐页面**

### 🔧 功能列表
- 展示系统推荐的路线块列表（推荐使用 card 组件）
  - 每个块展示：起点、终点、途经地点、预计时间
- 点击任一路线跳转至页面3，传入该路线ID

### 📦 数据结构
```js
{
  routes: [
    {
      id: "route001",
      start: "地点A",
      end: "地点B",
      waypoints: ["点1", "点2"],
      duration: "30分钟"
    }
  ]
}
```

---

## 📍 页面 3：**路线详情页面**

### 🔧 功能列表
- 地图展示路线路径（`polyline` 方式高亮）
- 简要路线介绍（途径点）
- “开始导航”按钮 → 跳转至页面4

### 📦 数据结构
```js
{
  routeId: "route001",
  polylinePoints: [{ lat, lng }],
  waypoints: [...],
  duration: ...
}
```

---

## 📍 页面 4：**导航页面**

### 🔧 功能列表
- 实时地图导航展示（高亮路线）
- 用户当前位置更新
- 接近某个“特定预设点”后弹出按钮
  - 判断方法：当前定位是否在某个范围内
  - 点击弹出按钮 → 跳转页面5

### 📦 数据结构
```js
{
  polyline: [...],
  currentPosition: { lat, lng },
  specialPoints: [{ id, name, location }]
}
```

---

## 📍 页面 5：**景点讲解页面**

### 🔧 功能列表
- 显示景点图片
- AI生成文字讲解（实时请求腾讯云大模型 API）
- 文字讲解模块：点击播放语音（支持暂停/继续/重复）
- 语音问答功能（录音或文本输入）
- 上传图片后识别并讲解（AI图像识别+讲解）

### 📦 数据结构
```js
{
  placeInfo: {
    id: "poi123",
    name: "颐和园",
    images: [...],
    description: "由大模型生成..."
  },
  qaHistory: [
    { type: "text/audio", question, answer }
  ]
}
```

---

## 🤖 AI能力调用设计（腾讯云）

### 1. **文字讲解**
- 接口：`腾讯云大模型 API`
- 输入：地点名称 / 简要描述
- 输出：内容文本（用于显示+语音播放）

### 2. **语音问答**
- 输入：文字或录音（需使用微信录音能力 + 音频转文字）
- 请求腾讯云大模型获取答案

### 3. **图片识别讲解**
- 上传图片后，使用图像识别模型获取场景
- 输入识别结果 → 请求腾讯云大模型生成讲解

---

## 🔐 所需用户权限

| 权限 | 用途 |
|------|------|
| 定位权限 | 获取当前位置、路线导航 |
| 麦克风权限 | 语音输入（语音问答） |
| 相机权限 | 实时拍照图片讲解 |
| 相册读取 | 上传本地图片 |

---

## 🧩 页面参数与状态管理建议

- 页面跳转参数传递：使用 URL query 参数（如 `navigateTo({ url: '...&id=xxx' })`）
- 跨页面共享变量：使用 `app.globalData` 管理如当前位置等状态
- 临时数据缓存：可使用 `wx.setStorageSync()` 储存用户选项、历史记录

---

## 📁 文件结构建议（参考）

```bash
/pages
  /index         # 首页
  /routes        # 路线推荐
  /routeDetail   # 路线详情
  /navigate      # 步行导航
  /explain       # 景点讲解
/components
  /SearchBox
  /RouteCard
  /VoicePlayer
  /AIInput
/utils
  map.js         # 腾讯地图相关封装
  ai.js          # 腾讯云大模型封装
  auth.js        # 权限申请封装
```

---

## 🧪 后续开发阶段建议

| 阶段 | 工作内容 |
|------|----------|
| 1️⃣ 页面原型搭建 | 完成5个页面的界面和跳转结构 |
| 2️⃣ 地图功能实现 | 集成腾讯地图、搜索、polyline 路线渲染 |
| 3️⃣ 路线推荐数据接入 | 固定数据or模拟API加载 |
| 4️⃣ 景点讲解功能 | 接入腾讯云大模型，测试AI文本与语音模块 |
| 5️⃣ 语音问答、图片识别 | 实现上传图片/录音与大模型对接 |
| 6️⃣ 权限处理与测试 | 添加用户权限提示、完整流程测试 |
